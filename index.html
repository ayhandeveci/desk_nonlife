<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Viewer</title>

<script src="https://apis.google.com/js/api.js"></script>

<style>
body { margin:0; font-family:Arial; }
#top { padding:10px; background:#fff; border-bottom:1px solid #ccc; }
.container { display:flex; height:100vh; }

/* SOL */
#left {
  width:480px; min-width:480px;
  border-right:2px solid #ccc;
  padding:10px; box-sizing:border-box;
}
.list-wrap { display:flex; gap:10px; }
.list-box { width:50%; }
.list-title { text-align:center; font-weight:bold; margin-bottom:8px; }
.list-area {
  border:1px solid #aaa;
  border-radius:4px;
  max-height:80vh;
  overflow-y:auto;
  padding:5px;
  background:#fafafa;
}
.png-btn {
  width:100%; margin-bottom:6px; padding:6px;
  border-radius:5px; border:1px solid #bbb;
  background:#fff; cursor:pointer; text-align:left;
}
.png-btn:hover { background:#eee; }

/* SAĞ */
#right { flex:1; padding:20px; overflow-y:auto; }
.panel {
  border:1px solid #ccc; margin-bottom:20px;
  border-radius:6px; background:#fff;
}
.panel-title {
  padding:10px; background:#f2f2f2;
  border-bottom:1px solid #ddd; text-align:center;
  font-weight:bold;
}
.img-area {
  max-height:65vh; overflow:auto; padding:10px;
  background:#fff;
}
img {
  max-width:85%; height:auto; display:block; margin:auto;
  box-shadow:0 0 10px rgba(0,0,0,0.15);
}

/* Laptop optimize */
@media (min-width:900px){
  #right { max-width:1400px; margin:0 auto; }
}
</style>
</head>

<body>

<div id="top">
  <input type="file" id="jsonFile" accept=".json">
  <button onclick="start()">Yükle</button>
  <span id="status" style="margin-left:20px;font-weight:bold;"></span>
</div>

<div class="container">

  <div id="left">
    <div class="list-wrap">
      <div class="list-box">
        <div class="list-title">SORULAR</div>
        <div id="qlist" class="list-area"></div>
      </div>
      <div class="list-box">
        <div class="list-title">CEVAPLAR</div>
        <div id="alist" class="list-area"></div>
      </div>
    </div>
  </div>

  <div id="right">
    <div class="panel">
      <div id="qTitle" class="panel-title">Soru seçilmedi</div>
      <div id="qImg" class="img-area"></div>
    </div>
    <div class="panel">
      <div id="aTitle" class="panel-title">Cevap seçilmedi</div>
      <div id="aImg" class="img-area"></div>
    </div>
  </div>

</div>

<script>
/* ---- FOLDER ID'LER ---- */
const QF = "1SM8NcS58qf-L9wOZ-ywZzg9gKhERZoK3";
const AF = "17IJCUY7xl52-YRyg7lP4FBJ-G3OohPx0";

let SA = null;

/* ---- JSON YÜKLE ---- */
document.getElementById("jsonFile").addEventListener("change", ev => {
  const f = ev.target.files[0];
  const r = new FileReader();
  r.onload = e => SA = JSON.parse(e.target.result);
  r.readAsText(f);
});

async function start(){
  if(!SA){ alert("JSON yok"); return; }
  document.getElementById("status").textContent="Yükleniyor…";

  await loadGapi();
  await authorizeSA();

  const q = await listPng(QF);
  const a = await listPng(AF);

  fillList("qlist", q, true);
  fillList("alist", a, false);

  document.getElementById("status").textContent="Hazır!";
}

/* ---- DRIVE API ---- */
function loadGapi(){
  return new Promise(res=>{
    gapi.load("client", ()=> res());
  });
}

async function authorizeSA(){
  const jwt = new gapi.auth.JWT(
    SA.client_email,
    null,
    SA.private_key,
    ["https://www.googleapis.com/auth/drive.readonly"]
  );
  await jwt.authorize();
  gapi.client.setToken({access_token: jwt.credentials.access_token});
}

async function listPng(folder){
  const resp = await gapi.client.request({
    path: "https://www.googleapis.com/drive/v3/files",
    params:{
      q: `'${folder}' in parents and mimeType='image/png'`,
      fields:"files(id,name)"
    }
  });
  return resp.result.files.sort((a,b)=>a.name.localeCompare(b.name,'tr'));
}

/* ---- LİSTE BAS ---- */
function fillList(id, arr, isQ){
  const box = document.getElementById(id);
  box.innerHTML="";
  arr.forEach(f=>{
    const b=document.createElement("button");
    b.className="png-btn";
    b.textContent=f.name;
    b.onclick=()=> show(f,isQ);
    box.appendChild(b);
  });
}

/* ---- GÖSTER ---- */
function show(f,isQ){
  const link = `https://drive.google.com/uc?export=view&id=${f.id}`;
  if(isQ){
    document.getElementById("qTitle").textContent="Soru: "+f.name;
    document.getElementById("qImg").innerHTML=`<img src="${link}">`;
  }else{
    document.getElementById("aTitle").textContent="Cevap: "+f.name;
    document.getElementById("aImg").innerHTML=`<img src="${link}">`;
  }
}
</script>

</body>
</html>
