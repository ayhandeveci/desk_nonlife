<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>PNG Viewer</title>
<style>
    body { margin: 0; font-family: Arial; display: flex; height: 100vh; }
    #sidebar {
        width: 280px; 
        background: #f4f4f4; 
        border-right: 1px solid #ddd;
        padding: 10px; 
        overflow-y: auto;
    }
    #content {
        flex: 1; 
        display: flex; 
        justify-content: center; 
        align-items: center;
        background: #fafafa;
    }
    #content img {
        max-width: 90%;
        max-height: 90%;
        border: 1px solid #ccc;
        background: white;
    }
    .file-item {
        padding: 8px;
        margin: 4px 0;
        background: white;
        cursor: pointer;
        border-radius: 5px;
        border: 1px solid #ddd;
    }
    .file-item:hover { background: #e7e7e7; }
</style>
</head>

<body>

<div id="sidebar">
    <h3>Google Drive PNG Listesi</h3>

    <label>Access Token:</label><br>
    <input id="tokenInput" type="text" style="width:100%; margin-bottom:10px;" placeholder="Google Drive access token gir">
    
    <label>Klasör ID:</label><br>
    <input id="folderInput" type="text" style="width:100%; margin-bottom:10px;" placeholder="Folder ID">

    <button onclick="loadPNGs()">Listele</button>

    <hr>
    <div id="fileList"></div>
</div>

<div id="content">
    <p>Bir PNG seçiniz...</p>
</div>

<script>
async function loadPNGs() {
    const token = document.getElementById("tokenInput").value.trim();
    const folderId = document.getElementById("folderInput").value.trim();

    if (!token || !folderId) {
        alert("Token ve Folder ID gerekli!");
        return;
    }

    const url =
      `https://www.googleapis.com/drive/v3/files?q='${folderId}'+in+parents+and+mimeType='image/png'&fields=files(id,name)&key=`; 
    
    const res = await fetch(url, {
        headers: { Authorization: `Bearer ${token}` }
    });

    const data = await res.json();
    const fileList = document.getElementById("fileList");
    fileList.innerHTML = "";

    if (!data.files || data.files.length === 0) {
        fileList.innerHTML = "PNG bulunamadı.";
        return;
    }

    data.files.forEach(file => {
        const div = document.createElement("div");
        div.className = "file-item";
        div.textContent = file.name;
        div.onclick = () => showPNG(file.id, token);
        fileList.appendChild(div);
    });
}

function showPNG(fileId, token) {
    const url = `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`;

    const content = document.getElementById("content");
    content.innerHTML = `<img src="${url}" style="max-width:90%; max-height:90%;" 
                         onerror="this.src=''; alert('Görüntü yüklenemedi');"
                         />`;

    // Token'ı header'a eklemek için fetch kullanıyoruz (çünkü img tag header gönderemez)
    fetch(url, { headers: { Authorization: `Bearer ${token}` } })
      .then(r => r.blob())
      .then(blob => {
          const imgURL = URL.createObjectURL(blob);
          content.innerHTML = `<img src="${imgURL}">`;
      });
}
</script>

</body>
</html>
